---
title: "주문·결제 시스템에서 트랜잭션 경계를 나누는 기준"
date: 2026-02-25
categories: [architecture]
tags: [spring, transaction, backend]
---

커머스 시스템에서 가장 많이 고민했던 부분은 트랜잭션 범위였다.
특히 주문 생성, 결제 승인, 상태 업데이트가 하나의 흐름처럼 보이지만 실제로는 서로 다른 책임을 가진다.

초기에 모든 로직을 하나의 REQUIRED 트랜잭션으로 묶었을 때 문제는 명확했다.

* 외부 PG 지연 시 전체 롤백
* 로그 데이터까지 함께 rollback
* 장애 분석 어려움

그래서 다음 기준으로 경계를 나눴다.

1. 주문 생성 → REQUIRED
2. 결제 승인 → REQUIRES_NEW
3. 상태 로그 기록 → 별도 트랜잭션

REQUIRES_NEW를 사용한 이유는 실패 격리였다.
결제 실패가 주문 데이터까지 롤백시키는 구조는 운영에서 리스크가 컸다.

아키텍처 관점에서 중요한 건 기술 선택보다
“어디서 실패를 끊어낼 것인가”였다.
